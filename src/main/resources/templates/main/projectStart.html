<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}"
      th:with="activePage='config'">

<body>
<div layout:fragment="content">
	<div class="config-wrapper" style="position: relative;">
    <div class="bookmark" onclick="location.href='/projectConfig'">설정</div>
		<div class="bookmark2" style="margin-top: 52px;" onclick="location.href='/projectStart'">실행</div>
        <!-- 설정하기 화면 -->
        <div id="config" class="section-wrapper config-section">
        
<table style="width:100%;margin:0;padding:0;" border="0">
           <tbody>
               <tr>
                   <td class="tdContent">         
                       <div id="divProjectPro">
                           <h3 class="h3-project" style="font-size:24px;">프로젝트</h3>                                
                           <div>
                               <span class="inputLabel">프로젝트ID</span>
                               <input id="projectId" type="text" class="text" style="width:100px;margin-left:10px;text-align:center;" disabled>
                               <input id="projectName" type="text" class="text" style="width:179px;margin-left:5px;" disabled>
                               <button type="button" class="btn btn-secondary" onclick="openPopup2()" style="width: 3%;">...</button>          
                           </div>
                       </div>
                   </td>
               </tr>
           </tbody>
</table>
<!-- API 리스트 -->
        <div style="margin-top: 20px;">
            <h3 class="h3-project" style="font-size:24px;">API 목록</h3>
            <table>
                <thead>
                    <tr>
                    	<th style="width:86px;">No.</th>
					     <th style="text-align:center;">API 이름</th>
					     <th style="text-align:center;">요청 URL</th>
					     <th style="text-align:center;">응답 형식</th>
					     <th style="text-align:center;">실행</th>
                    </tr>
                </thead>
                <tbody>
                <!--  <tr th:each="source : ${sourceList}">
		                <td th:text="'S'+${source.sourceId}"></td>
		              	<td th:text="${source.sourceName}"></td>
		              	<td th:text="${source.baseUrl}"></td> -->
		        <tr>
		            <td>1</td>
		            <td>2</td>
		            <td>3</td>
              	    <td>JSON</td> 
              	<td style="text-align: center;"><button type="button" onclick="openPopup5()" class="btn btn-outline-primary" style="font-size: 13px;">URL 확인 </button>
              	</td>
                    </tr>
                </tbody>
            </table>
        		 <div style="margin-top: 15px;">
		  <button type="button" class="btn btn-outline-primary" onclick="openPopup3()">추가</button>
		  <button type="button" class="btn btn-outline-warning" onclick="deleteSource()">삭제</button>
	</div>
</div>

            <!-- 입력/출력 항목을 좌우로 배치하는 래퍼 -->
            <div class="io-wrapper" style="display: flex; gap: 20px; margin-top: 30px;">
            <!-- 입력 항목 -->
<div style="flex: 1;">
    <h3 class="h3-project" style="font-size:24px;">입력 항목</h3>
    <table border="1" style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr>
                <th style="text-align:center;">입력 ID</th>
                <th style="text-align:center;">입력명</th>
                <th style="text-align:center;">입력항목 키</th>
                <th style="text-align:center;">입력값</th>
            </tr>
        </thead>
       <tbody>
		  <tr>
		    <td>IN001</td>
		    <td>지역</td>
		    <td>region</td>
		    <td>대전광역시</td>
		  </tr>
		  <tr>
		    <td>IN002</td>
		    <td>날짜</td>
		    <td>date</td>
		    <td>2025-07-31</td>
		  </tr>
		  <tr>
		    <td>IN003</td>
		    <td>시간</td>
		    <td>hour</td>
		    <td>12:00</td>
		  </tr>
		</tbody>
    </table>
</div>

<!-- 출력 항목 -->
<div style="flex: 1;">
    <h3 class="h3-project" style="font-size:24px;">출력 항목</h3>
    <table border="1" style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr>
                <th style="text-align:center;">출력 ID</th>
                <th style="text-align:center;">출력명</th>
                <th style="text-align:center;">출력항목 키</th>
                <th style="text-align:center;">출력값</th>
            </tr>
        </thead>
        <tbody>
              <tr>
			    <td>OUT001</td>
			    <td>기온</td>
			    <td>temp</td>
			    <td style="width:159px"><input type="text" value="31.5℃" style="width: 70%; box-sizing: border-box;"></td>
			  </tr>
			  <tr>
			    <td>OUT002</td>
			    <td>하늘상태</td>
			    <td>sky</td>
			    <td><input type="text" value="맑음" style="width: 70%; box-sizing: border-box;"></td>
			  </tr>
			  <tr>
			    <td>OUT003</td>
			    <td>강수확률</td>
			    <td>rainProb</td>
			    <td><input type="text" value="20%" style="width: 70%; box-sizing: border-box;"></td>
			  </tr>
        </tbody>
    </table>
</div>
</div>
</div>
</div>
<!-- popup2 (...실행시 프로젝트 리스트 나오는 설정칸 ) -->
<div id="popup2">
  <div class="popup2-header">
    프로젝트 선택
    <span class="popup2-close" onclick="closePopup2()">×</span>
  </div>

  <div class="popup2-body">
    <table id="projectTable" class="project-table">
      <thead>
        <tr>
          <th>프로젝트ID</th>
          <th>프로젝트명</th>
        </tr>
      </thead>
      <tbody>
         <tr th:each="project : ${projectList}">
         <td th:text="'P'+${project.projectId}"></td>
         <td th:text="${project.projectName}"></td>
      </tr>
      </tbody>
    </table>
    <div class="popup2-buttons">
      <button type="button" class="btn btn-secondary" onclick="confirmSelection()">확인</button>
      <button type="button" class="btn btn-outline-secondary" onclick="closePopup2()">닫기</button>
    </div>
  </div>
</div>


<!-- popup5 (실행칸) -->
<div id="popup5">
  <div class="popup2-header">
    URL 확인
    <span class="popup2-close" onclick="closePopup5()">×</span>
  </div>
	
  <div class="popup2-body">
                <!-- 텍스트 영역 -->
			      <div class="mb-3">
			      <textarea id="totalUrl" rows="4" style="width: 100%; resize: vertical;"></textarea>
			    </div>

                <!-- 버튼 영역 -->
                <div class="buttons">
                    <button class="btn btn-success" style="margin-top: -27px; margin-left:431px">Excel 다운로드</button>
                </div>
            </div>
  </div>
</div>
<!-- pageScript 프래그먼트로 스크립트 채우기 -->
<th:block layout:fragment="pageScript">
<script>
window.addEventListener('DOMContentLoaded', () => {
    const path = window.location.pathname;

    if (path.includes("projectConfig")) {
        document.querySelector(".bookmark").classList.add("active");
    } else if (path.includes("projectStart")) {
        document.querySelector(".bookmark2").classList.add("active");
    }
});
function testConnection(button) {
    // 여기에 실제 연결 테스트 로직 또는 API 호출을 넣을 수도 있음
    const success = Math.random() > 0.5; // 임시로 성공/실패 무작위 처리

    if (success) {
        alert("연결되었습니다.");
    } else {
        alert("연결에 실패하였습니다.");
    }
}
function openPopup2() {
    document.getElementById("popup2").style.display = "block";
  }

//테이블 행 클릭 시
let selectedProject = null;

document.addEventListener("DOMContentLoaded", function () {
const projectTable = document.getElementById("projectTable");
const rows = projectTable.querySelectorAll("tbody tr");

rows.forEach(row => {
 row.addEventListener("click", function () {
   // 기존 선택 제거
   rows.forEach(r => r.classList.remove("highlight"));

   // 현재 선택한 행에 하이라이트
   this.classList.add("highlight");

   // 선택된 프로젝트 값 저장
   const cells = this.getElementsByTagName("td");
   selectedProject = {
     projectId: cells[0].innerText.trim(),
     projectName: cells[1].innerText.trim()
   };
 });
});
});
//팝업 닫기
function closePopup2() {
  document.getElementById("popup2").style.display = "none";
  selectedProject = null;

  // 강조 해제
  document.querySelectorAll(".project-table tbody tr").forEach(row => {
    row.classList.remove("highlight");
  });
}
function openPopup5() {
    document.getElementById("popup5").style.display = "block";
  }
function closePopup5() {
    document.getElementById("popup5").style.display = "none";
   }
</script>
</body>
</html>
